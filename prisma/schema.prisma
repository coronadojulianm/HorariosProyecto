generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Actividad {
  id_actividad  Int         @id @default(autoincrement())
  descripcion   String?     @db.VarChar(200)
  fecha         DateTime?
  evidencia     String?     @db.VarChar(100)
  instructor    String?     @db.VarChar(50)
  productiva    Int?
  productiva_fk Productiva? @relation(fields: [productiva], references: [id_productiva])

  @@index([productiva], name: "actividad_seguimiento")
}

model Ambiente {
  id_ambiente  Int        @id @default(autoincrement())
  nombre_amb   String?    @db.VarChar(80)
  municipio    Int?
  sede         Sede?
  estado       Estado?
  municipio_fk Municipio? @relation(fields: [municipio], references: [id_municipio])
  Horario      Horario[]

  @@index([municipio], name: "municipio_ambiente")
}

model Area {
  id_area     Int           @id @default(autoincrement())
  nombre_area String?       @db.VarChar(80)
  Vinculacion Vinculacion[]
}

model Asignacion {
  id_asignacion Int               @id @default(autoincrement())
  fecha_inicio  DateTime?
  fecha_fin     DateTime?
  productiva    Int?
  instructor    Int?
  estado        EstadoAsignacion?
  productiva_fk Productiva?       @relation(fields: [productiva], references: [id_productiva])
  instructor_fk Vinculacion?      @relation(fields: [instructor], references: [id_vinculacion])

  @@index([instructor], name: "asignacion_vinculacacion")
  @@index([productiva], name: "asignacion_practica")
}

model Bitacora {
  id_bitacora    Int             @id @default(autoincrement())
  fecha          DateTime?
  bitacora       BitacoraEnum?
  seguimiento    Int?
  archivo        String?         @db.VarChar(100)
  estado         EstadoBitacora?
  instructor     String?         @db.VarChar(50)
  seguimiento_fk Seguimiento?    @relation(fields: [seguimiento], references: [id_seguimiento])

  @@index([seguimiento], name: "seguimiento_bitacora")
}

model Empresa {
  id_empresa   Int          @id @default(autoincrement())
  razon_social String?      @db.VarChar(80)
  direccion    String?      @db.VarChar(80)
  telefono     String?      @db.VarChar(20)
  correo       String?      @db.VarChar(80)
  municipio    Int?
  estado       Estado?
  municipio_fk Municipio?   @relation(fields: [municipio], references: [id_municipio])
  Productiva   Productiva[]

  @@index([municipio], name: "empresa_minicipio")
}

model Ficha {
  codigo       Int          @id
  inicio_ficha DateTime?
  fin_lectiva  DateTime?
  fin_ficha    DateTime?
  programa     Int?
  sede         Sede?
  estado       EstadoFicha?
  programa_fk  Programa?    @relation(fields: [programa], references: [id_programa])
  Horario      Horario[]
  Matricula    Matricula[]

  @@index([programa], name: "ficha_programa")
}

model Horario {
  id_horario     Int            @id @default(autoincrement())
  fecha_inicio   DateTime?
  hora_inicio    DateTime?      @db.Time
  fecha_fin      DateTime?
  hora_fin       DateTime?      @db.Time
  dia            Dia?
  cantidad_horas Int?
  instructor     Int?
  ficha          Int?
  ambiente       Int?
  estado         EstadoHorario?
  ambiente_fk    Ambiente?      @relation(fields: [ambiente], references: [id_ambiente])
  ficha_fk       Ficha?         @relation(fields: [ficha], references: [codigo])
  instructor_fk  Vinculacion?   @relation(fields: [instructor], references: [id_vinculacion])

  @@index([ambiente], name: "hoario_ambiente")
  @@index([ficha], name: "horario_ficha")
  @@index([instructor], name: "vinculacion_horario")
}

model Matricula {
  id_matricula            Int              @id @default(autoincrement())
  ficha                   Int?
  aprendiz                Int?
  estado                  EstadoMatricula?
  pendiente_tecnicos      Int?
  pendiente_transversales Int?
  pendiente_ingles        Int?
  ficha_fk                Ficha?           @relation(fields: [ficha], references: [codigo])
  aprendiz_fk             Persona?         @relation(fields: [aprendiz], references: [id_persona])
  Productiva              Productiva[]

  @@unique([ficha, aprendiz], name: "uiniquematricula")
  @@index([aprendiz], name: "matriculas_personas")
}

model Municipio {
  id_municipio Int        @id @default(autoincrement())
  nombre_mpio  String?    @db.VarChar(80)
  departamento String?    @db.VarChar(80)
  Ambiente     Ambiente[]
  Empresa      Empresa[]
  Persona      Persona[]
}

model Persona {
  id_persona     Int           @id @default(autoincrement())
  identificacion BigInt?
  nombres        String?       @db.VarChar(80)
  correo         String?       @db.VarChar(80)
  telefono       String?       @db.VarChar(40)
  password       String?       @db.VarChar(25)
  rol            Rol?
  cargo          Cargo?
  municipio      Int?
  municipio_fk   Municipio?    @relation(fields: [municipio], references: [id_municipio])
  Matricula      Matricula[]
  Vinculacion    Vinculacion[]

  @@unique([identificacion], name: "identificacion_unique")
  @@index([municipio], name: "persona_municipio")
}

model Productiva {
  id_productiva Int               @id @default(autoincrement())
  matricula     Int?
  empresa       Int?
  fecha_inicio  DateTime?
  fecha_fin     DateTime?
  alternativa   Alternativa?
  estado        EstadoProductiva?
  acuerdo       String?           @db.VarChar(100)
  arl           String?           @db.VarChar(100)
  consulta      String?           @db.VarChar(100)
  matricula_fk  Matricula?        @relation(fields: [matricula], references: [id_matricula])
  empresa_fk    Empresa?          @relation(fields: [empresa], references: [id_empresa])
  actividades   Actividad[]
  Asignacion    Asignacion[]
  Seguimiento   Seguimiento[]

  @@index([empresa], name: "empresa_matricula")
  @@index([matricula], name: "aprendiz_matricula")
}

model Programa {
  id_programa     Int     @id @default(autoincrement())
  nombre_programa String? @db.VarChar(80)
  sigla           String? @db.VarChar(20)
  nivel           Nivel?
  estado          Estado?
  Ficha           Ficha[]
}

model Seguimiento {
  id_seguimiento Int                @id @default(autoincrement())
  fecha          DateTime?
  seguimiento    SeguimientoEnum?
  productiva     Int?
  estado         EstadoSeguimiento?
  archivo        String?            @db.VarChar(100)
  instructor     String?            @db.VarChar(50)
  productiva_fk  Productiva?        @relation(fields: [productiva], references: [id_productiva])
  Bitacora       Bitacora[]

  @@index([productiva], name: "matricula_aprenidiz")
}

model Vinculacion {
  id_vinculacion Int          @id @default(autoincrement())
  instructor     Int?
  tipo           Tipo?
  sede           Sede?
  area           Int?
  area_fk        Area?        @relation(fields: [area], references: [id_area])
  instructor_fk  Persona?     @relation(fields: [instructor], references: [id_persona])
  Asignacion     Asignacion[]
  Horario        Horario[]

  @@index([instructor], name: "vinculacion_horario")
  @@index([area], name: "vinculacion_area")
}

enum Sede {
  centro
  yamboro
}

enum Estado {
  activo
  inactivo
}

enum EstadoAsignacion {
  Activo
  Inactivo
}

enum BitacoraEnum {
  ONE
  TWO
  THREE
  FOUR
  FIVE
  SIX
  SEVEN
  EIGHT
  NINE
  TEN
  ELEVEN
  TWELVE
}

enum EstadoBitacora {
  solicitud
  aprobado
  no_aprobado
}

enum Dia {
  lunes
  martes
  miercoles
  jueves
  viernes
  sabados
  domingo
}

enum EstadoHorario {
  solicitud
  aprobado
  no_aprobado
}

enum EstadoMatricula {
  Induccion
  Formacion
  Condicionado
  Cancelado
  RetiroVoluntario
  PorCertificar
  Certificado
}

enum Rol {
  Instructor
  Coordinador
  Lider
  Seguimiento
}

enum Cargo {
  Instructor
  Aprendiz
  Coordinador
  Administrativo
}

enum Alternativa {
  Contrato_de_Aprendizaje
  Proyecto_Productivo
  Pasantias
  Monitoria
}

enum EstadoProductiva {
  Inicio
  Renuncia
  Terminado
}

enum Nivel {
  Tecnico
  Tecnologo
  Auxiliar
  Especializacion
}

enum EstadoFicha {
  activa
  terminada
}

enum SeguimientoEnum {
  visita
  llamada
  documento
  otra
}

enum EstadoSeguimiento {
  solicitud
  aprobado
  no_aprobado
}

enum Tipo {
  Vinculacion
  Contratista
}
